YUI.add("hermes-template-sub-photo-contexts-title-groups",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,"!==",0,{name:"ifCond",hash:{},fn:n.program(2,o,0),inverse:n.noop,data:o,loc:{start:{line:3,column:2},end:{line:5,column:13}}}))?a:"")+(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,"===",0,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:6,column:2},end:{line:8,column:13}}}))?a:"")},2:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalGroups"):e,intlName:"photo-page-scrappy.GROUPS_COUNT"},data:o,loc:{start:{line:4,column:3},end:{line:4,column:79}}}))+"\n"},4:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_IN_NO_GROUPS"},data:o,loc:{start:{line:7,column:3},end:{line:7,column:67}}}))+"\n"},6:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,"===",1,{name:"ifCond",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:10,column:2},end:{line:12,column:13}}}))?a:"")+(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,">",1,{name:"ifCond",hash:{},fn:n.program(9,o,0),inverse:n.noop,data:o,loc:{start:{line:13,column:2},end:{line:15,column:13}}}))?a:"")+(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,"===",0,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:16,column:2},end:{line:18,column:13}}}))?a:"")},7:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_IN_ONE_GROUP"},data:o,loc:{start:{line:11,column:3},end:{line:11,column:67}}}))+"\n"},9:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalGroups"):e,intlName:"photo-page-scrappy.PHOTO_IN_MANY_GROUPS"},data:o,loc:{start:{line:14,column:3},end:{line:14,column:87}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(n,e,l,t,o){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<h5 class="total">\n'+(null!=(a=r(l,"if").call(null!=e?e:n.nullContext||{},null!=e?r(e,"isMobile"):e,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.program(6,o,0),data:o,loc:{start:{line:2,column:1},end:{line:19,column:8}}}))?a:"")+"</h5>"},useData:!0}),t={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(t[e]=l)})),n.Template.register("hermes/sub-photo-contexts-title-groups",(function(e,o){return(o=o||{}).partials=o.partials?n.merge(t,o.partials):t,l(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-contexts-groups",(function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"canAddOrInvite"):t,{name:"if",hash:{},fn:n.program(2,o,0),inverse:n.noop,data:o,loc:{start:{line:2,column:1},end:{line:12,column:8}}}))?a:""},2:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<div class="sub-photo-context sub-photo-context-groups empty">\n\t\t\t<p tabindex="0">'+n.escapeExpression((s(e,"intlMessage")||t&&s(t,"intlMessage")||n.hooks.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_NOT_IN_GROUPS"},data:o,loc:{start:{line:4,column:19},end:{line:4,column:84}}}))+"</p>\n"+(null!=(a=s(e,"if").call(r,null!=t?s(t,"canAdd"):t,{name:"if",hash:{},fn:n.program(3,o,0),inverse:n.noop,data:o,loc:{start:{line:5,column:3},end:{line:7,column:10}}}))?a:"")+(null!=(a=s(e,"if").call(r,null!=t?s(t,"canInvite"):t,{name:"if",hash:{},fn:n.program(5,o,0),inverse:n.noop,data:o,loc:{start:{line:8,column:3},end:{line:10,column:10}}}))?a:"")+"\t\t</div>\n"},3:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t<p><a href='#' class='add-to'>"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GROUP"},data:o,loc:{start:{line:6,column:34},end:{line:6,column:92}}}))+"</a></p>\n"},5:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t<p><a href='#' class='add-to'>"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.INVITE_TO_GROUP"},data:o,loc:{start:{line:9,column:34},end:{line:9,column:95}}}))+"</a></p>\n"},7:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=s(e,"if").call(r,null!=t?s(t,"viewerIsOwner"):t,{name:"if",hash:{},fn:n.program(8,o,0),inverse:n.noop,data:o,loc:{start:{line:14,column:1},end:{line:25,column:8}}}))?a:"")+'\t<div class="sub-photo-context sub-photo-context-groups">\n'+(null!=(a=n.invokePartial(s(l,"sub-photo-contexts-title-groups"),t,{name:"sub-photo-contexts-title-groups",data:o,indent:"\t\t",helpers:e,partials:l,decorators:n.decorators}))?a:"")+(null!=(a=s(e,"if").call(r,null!=t?s(t,"canAdd"):t,{name:"if",hash:{},fn:n.program(14,o,0),inverse:n.noop,data:o,loc:{start:{line:28,column:2},end:{line:30,column:9}}}))?a:"")+(null!=(a=s(e,"if").call(r,null!=t?s(t,"canInvite"):t,{name:"if",hash:{},fn:n.program(16,o,0),inverse:n.noop,data:o,loc:{start:{line:31,column:2},end:{line:33,column:9}}}))?a:"")+'\t\t<ul class="context-list">\n'+(null!=(a=s(e,"each").call(r,null!=t?s(t,"contexts"):t,{name:"each",hash:{},fn:n.program(18,o,0),inverse:n.noop,data:o,loc:{start:{line:35,column:3},end:{line:37,column:12}}}))?a:"")+"\t\t</ul>\n"+(null!=(a=s(e,"if").call(r,null!=t?s(t,"showMore"):t,{name:"if",hash:{},fn:n.program(20,o,0),inverse:n.noop,data:o,loc:{start:{line:39,column:2},end:{line:41,column:9}}}))?a:"")+"\t</div>\n"},8:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=(r(e,"ifCond")||t&&r(t,"ifCond")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?r(t,"totalInvitations"):t,">",0,{name:"ifCond",hash:{},fn:n.program(9,o,0),inverse:n.noop,data:o,loc:{start:{line:15,column:2},end:{line:24,column:13}}}))?a:""},9:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},s=n.hooks.helperMissing,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<div class="invitation-notice" tabindex="0">\n'+(null!=(a=(i(e,"ifCond")||t&&i(t,"ifCond")||s).call(r,null!=t?i(t,"totalInvitations"):t,"===",1,{name:"ifCond",hash:{},fn:n.program(10,o,0),inverse:n.noop,data:o,loc:{start:{line:17,column:4},end:{line:19,column:15}}}))?a:"")+(null!=(a=(i(e,"ifCond")||t&&i(t,"ifCond")||s).call(r,null!=t?i(t,"totalInvitations"):t,">",1,{name:"ifCond",hash:{},fn:n.program(12,o,0),inverse:n.noop,data:o,loc:{start:{line:20,column:4},end:{line:22,column:15}}}))?a:"")+"\t\t\t</div>\n"},10:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t\t"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ONE_GROUP_INVITATION"},data:o,loc:{start:{line:18,column:5},end:{line:18,column:71}}}))+"\n"},12:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t\t"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{count:null!=t?a(t,"totalInvitationsFriendly"):t,intlName:"photo-page-scrappy.N_GROUP_INVITATIONS"},data:o,loc:{start:{line:21,column:5},end:{line:21,column:101}}}))+"\n"},14:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t<a href='#' class='add-to'>"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GROUP"},data:o,loc:{start:{line:29,column:30},end:{line:29,column:88}}}))+"</a>\n"},16:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t<a href='#' class='add-to'>"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.INVITE_TO_GROUP"},data:o,loc:{start:{line:32,column:30},end:{line:32,column:91}}}))+"</a>\n"},18:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=n.invokePartial(r(l,"sub-photo-contexts-item"),t,{name:"sub-photo-contexts-item",data:o,indent:"\t\t\t\t",helpers:e,partials:l,decorators:n.decorators}))?a:""},20:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<div class="view-all-contexts-of-type"><a href="#">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.VIEW_MORE_GROUPS"},data:o,loc:{start:{line:40,column:54},end:{line:40,column:116}}}))+"</a></div>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"empty"):t,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.program(7,o,0),data:o,loc:{start:{line:1,column:0},end:{line:43,column:7}}}))?a:""},usePartial:!0,useData:!0}),l={};n.Array.each(["sub-photo-contexts-title-groups","sub-photo-contexts-item"],(function(t){var e=n.Template.get("hermes/"+t);e&&(l[t]=e)})),n.Template.register("hermes/sub-photo-contexts-groups",(function(t,o){return(o=o||{}).partials=o.partials?n.merge(l,o.partials):l,e(t,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-contexts-title-groups","hermes-template-sub-photo-contexts-item"]});YUI.add("photo-group-invitation-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{},attributes:{id:{},photoId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0}},groupId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0}},invitedBy:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]});YUI.add("flickr-photos-getGroupInvitations-fetcher",(function(o,e){"use strict";o.namespace("ListFetchers")["flickr-photos-getGroupInvitations"]={run:function(i,t){var r=this;return o.Promise.all([t.callAPI("flickr.photos.getGroupInvitations",{photo_id:i.id,extras:o.APIHelper.request.getRebootGroupExtras()+", icon_urls",hermes:"1",include_pending:1}),t.getModelRegistry("photo-group-invitations-models"),t.getModelRegistry("photo-group-invitation-models"),t.getModelRegistry("group-pool-models"),t.getModelRegistry("group-models"),t.getModelRegistry("photo-group-pendings-models"),t.getModelRegistry("photo-group-pending-models")]).then((function(o){r._processResponse(o,i)}),o.FetcherErrorLogger(e))},_processResponse:function(e,i){var t,r,d=e[0],p=e[1],s=e[2],n=e[3],a=e[4],g=e[5],l=e[6],u=d.groups&&d.groups.group,h=i.id,c=[],v=[],m=[];u&&o.Array.each(u,(function(o,e){var t,r,d,p,g;t={id:[i.id,o.id].join("-"),photoId:i.id,groupId:o.id,invitedBy:o.invitedBy.nsid},r=s.addOrUpdate(t),d=a.parseGroupModel(i.id,i.pathAlias,o),p=a.addOrUpdate(d),g=n.addOrUpdate({id:o.id,pathAlias:o.pathAlias,group:p}),c.push(r),v.push(g)})),d&&d.pendingInvites&&o.Array.each(d.pendingInvites,(function(o,e){var t={id:[i.id,o.groupNsid].join("-"),photoId:i.id,groupId:o.groupNsid};m.push(l.addOrUpdate(t))})),r={id:h,pendings:m,total:m.length},g.addOrUpdate(r),t={id:h,groups:v,invitations:c,total:c.length},p.addOrUpdate(t)}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-group-invitations-models","group-models","group-pool-models","person-models","photo-group-invitation-models"]});YUI.add("flickr-groups-invite-photo-accept-updater",(function(o,t){"use strict";o.namespace("ModelUpdaters")["flickr-groups-invite-photo-accept"]={run:function(e,p){var r={},s=o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID);return r.user_id=e.userID,r.photo_id=e.photoID,r.group_id=s,o.Promise.all([p.callAPI("flickr.groups.invite.photo.accept",r),p.getModel("group-pool-models",s),p.getModelRegistry("photo-group-invitation-models"),p.getModelRegistry("photo-group-invitations-models"),p.getModel("photo-models",e.photoID),p.getModelRegistry("photo-groups-models"),p.getModelRegistry("photo-contexts-models")]).then((function(o){var t,p=o[0],r=o[1],l=o[2],i=o[3],u=o[4],a=o[5],g=o[6];if("ok"===p.stat)return r.addPhotoLocal(u),a.exists(e.photoID)&&!a.getValue(e.photoID,"groups").getFromListByID(r.getValue("id"))&&(a.getValue(e.photoID,"groups").prependToList(r),a.setValue(e.photoID,"total",a.getValue(e.photoID,"total")+1)),g.exists(e.photoID)&&!g.getValue(e.photoID,"contexts").getFromListByID(r.getValue("id"))&&(g.setValue(e.photoID,"totalGroups",g.getValue(e.photoID,"totalGroups")+1),g.getValue(e.photoID,"contexts").appendToList(r)),t=[e.photoID,s].join("-"),i.exists(e.photoID)&&i.getValue(e.photoID,"invitations").getFromListByID(t)&&(i.setValue(e.photoID,"total",i.getValue(e.photoID,"total")-1),i.getValue(e.photoID,"groups").removeFromList(s),i.getValue(e.photoID,"invitations").removeFromList(t)),l.remove(t),r})).then(null,o.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-invite-photo-decline-updater",(function(o,e){"use strict";o.namespace("ModelUpdaters")["flickr-groups-invite-photo-decline"]={run:function(t,r){var i={},p=o.Models["group-pool-models"].extractGroupFromCompoundId(t.groupID);return i.user_id=t.userID,i.photo_id=t.photoID,i.group_id=p,o.Promise.all([r.callAPI("flickr.groups.invite.photo.decline",i),r.getModel("group-pool-models",p),r.getModelRegistry("photo-group-invitation-models"),r.getModelRegistry("photo-group-invitations-models")]).then((function(o){var e,r=o[0],i=o[1],l=o[2],s=o[3];if("ok"===r.stat)return e=[t.photoID,p].join("-"),s.exists(t.photoID)&&s.getValue(t.photoID,"invitations").getFromListByID(e)&&(s.setValue(t.photoID,"total",s.getValue(t.photoID,"total")-1),s.getValue(t.photoID,"groups").removeFromList(p),s.getValue(t.photoID,"invitations").removeFromList(e)),l.remove(e),i})).then(null,o.FetcherErrorLogger(e))}}}),"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});