YUI.add("albums-list-route",(function(e){var t=require("hermes-core/type-validator"),a=50,s=100;function o(e){o.superclass.constructor.call(this,e)}e.Routes[this.name]=o,e.extend(o,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(o){var i,n,r,l=this,u={},m=o.params.nsid_or_path_alias,p=o.params&&o.params.set_id,g=p?s:25,d=this.getPageNumber(o),c=o.geo;return t.nsid(m)?u.id=m:u.pathAlias=m,n="/photos/"+m+"/albums/",i={page:s/g*(d-1)+1,perPage:g,withSetId:p},e.Promise.all([this.appContext.getModel("sets-models",u,i),this.appContext.getModel("person-models",u),this.appContext.getModel("person-contacts-count-models",u)]).then((function(u){var g=u[0],h=u[1],v=0;if(YUI.Env.isServer&&(v=Math.ceil(g.getValue("totalItems")/s),d>v&&i.page>1&&!isNaN(parseInt(o.params.page_number,10))))return e.Promise.resolve({redirect:n.replace(/page[0-9]+/,"")});if(p){var R=g.getValue("albumsList");if(-1===(r=R.getPageOf({id:p},a))||R.getNextIncompletePage(i)===r)return i.forceAPICall=!0,t.nsid(m)?i.id=m:i.pathAlias=m,R.getPage(i).then((function(e){return d=Math.ceil(R.getPageOf({id:p},a)*a/s),r=d,l.onRouteResolved(g,h,d,r,n,p,c)}),(function(t){return e.Promise.resolve({redirect:n})}));d=Math.ceil(r*a/s),r=d}else r=2*(d-1)+1;return l.onRouteResolved(g,h,d,r,n,p,c)}),(function(t){return t&&p?e.Promise.resolve({redirect:n}):t.timeout?l.appContext.getModel("person-models",u).then((function(t){var a=t.getValue("displayname"),s={view:"empty-page-view",layout:"scrolling",title:l.intlMessage({intlName:"common.USERS_ALBUMS",who:a}),params:{isSlow:!0,page:"albums",displayName:a,nsid:t.getValue("nsid")}};return e.Promise.resolve(s)}),(function(){return l.onRouteRejected(t,o)})):l.onRouteRejected(t,o)}))},onRouteResolved:function(t,o,i,n,r,l,u){var m,p=t.getValue("totalItems"),g=o.getValue("displayname");return m=0===parseInt(p,10)?{view:"empty-page-view",layout:"scrolling",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:g}),params:{displayName:g,nsid:o.getValue("nsid"),page:"albums",geo:u}}:{view:"albums-list-page-view",layout:"scrolling",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:g}),params:{nsid:t.id,withSetId:l,pageParams:{page:n,perPage:l?s:a,viewPageSize:s,nominalPage:i},geo:u,baseURL:r}},e.Promise.resolve(m)},onRouteRejected:function(t,a){if(t.fatal)throw t;return this.displayRouteErrors(a,new e.RouteError(404,this.intlMessage({intlName:"common.404_PERSON_NONEXISTENT"})))}}),e.mix(o.prototype,e.Localizable)}),"@VERSION@",{requires:["flickr-route","flickr-promise","sets-models","person-models"],langBundles:["common"]});