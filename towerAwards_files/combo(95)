YUI.add("hermes-template-gift-pro",(function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,l,a){var o=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<p class="gift-pro-container">\n\t\t<a href="?giftPro" class="gift-pro-link open-gift-modal">\n\t\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t\t<span class="gift-pro-text" title="'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:5,column:38},end:{line:5,column:80}}}))+'">'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:5,column:82},end:{line:5,column:124}}}))+"</span>\n\t\t</a>\n\t</p>\n"},3:function(n,e,t,l,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<div class="sub-photo-gift-user-container open-gift-modal">\n\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t<a\thref="?giftPro" class="gift user gift-pro-link">'+n.escapeExpression((o(t,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"checkout.SHOW_APPRECIATION_GIFT"},data:a,loc:{start:{line:12,column:53},end:{line:12,column:111}}}))+"</a>\n\t</div>\n"},5:function(n,e,t,l,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<div class="mobile-sub-photo-gift-user-container open-gift-modal">\n\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t<a\thref="?giftPro" class="gift user gift-pro-link">'+n.escapeExpression((o(t,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"checkout.SHOW_APPRECIATION_GIFT"},data:a,loc:{start:{line:18,column:53},end:{line:18,column:111}}}))+"</a>\n\t</div>\n"},7:function(n,e,t,l,a){var o=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<div href="?giftPro" class="gift-pro-container open-gift-modal">\n\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t<div class="gift-pro-link" title="'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:24,column:36},end:{line:24,column:78}}}))+'">'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:24,column:80},end:{line:24,column:122}}}))+"</div>\n\t</div>\n"},compiler:[8,">= 4.3.0"],main:function(n,e,t,l,a){var o,i=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","photostream",{name:"ifCond",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:0},end:{line:8,column:11}}}))?o:"")+(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","sub-photo-left",{name:"ifCond",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:9,column:0},end:{line:14,column:11}}}))?o:"")+(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","mobile-sub-photo",{name:"ifCond",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:15,column:0},end:{line:20,column:11}}}))?o:"")+(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","context-menu",{name:"ifCond",hash:{},fn:n.program(7,a,0),inverse:n.noop,data:a,loc:{start:{line:21,column:0},end:{line:26,column:11}}}))?o:"")+"\n"},useData:!0}),l={};n.Array.each([],(function(e){var t=n.Template.get("hermes/"+e);t&&(l[e]=t)})),n.Template.register("hermes/gift-pro",(function(e,a){return(a=a||{}).partials=a.partials?n.merge(l,a.partials):l,t(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("gift-pro-view",(function(e,i){require("hermes-core/flog")(i);var t=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.params=e,this.recipientNsid=e.nsid||e.recipientNsid,this.placement=e.placement||"photostream",this.isViewingSelf=!1,this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===e.nsid&&(this.isViewingSelf=!0),this},loadState:function(){var i=[];return i.push(this.appContext.getModel("person-models",this.recipientNsid).then(function(e){this.set("recipientModel",e)}.bind(this))),this.appContext.getViewer().signedIn&&i.push(this.appContext.getModel("person-relationship-models",this.recipientNsid).then(function(e){this.set("relationshipModel",e)}.bind(this))),e.Promise.all(i)},buildContainer:function(){this.canViewerGiftPro()&&this.setContainerWithTemplate("gift-pro",{placement:this.placement})},activate:function(){this.appContext.flipper.isFlipped("enable-gift-pro")&&this.canViewerGiftPro()&&this.registerEventHandler(this.get("container").one(".open-gift-modal").on("click",this.openModal.bind(this)))},canViewerGiftPro:function(){var e=!1;return this.appContext.flipper.isFlipped("enable-gift-pro")?(this.isViewingSelf||!this.get("recipientModel")||this.get("recipientModel").getValue("isPro")||(e=this.appContext.getViewer().signedIn?!(!this.get("relationshipModel")||this.get("relationshipModel").getValue("isIgnoredBy")||this.get("recipientModel").getValue("newFlow")):!t.doesCountryRequiresSignedInGifting(this.geo)),this.appContext.flipper.isFlipped("enable-gift-acceptance")&&!this.isViewingSelf&&this.get("recipientModel")&&(e=this.appContext.getViewer().signedIn?!(!this.get("relationshipModel")||!this.get("recipientModel").getValue("isEligibleForGifts")):!t.doesCountryRequiresSignedInGifting(this.geo)),e):e},openModal:function(i){var s;i&&(i.stopPropagation(),i.preventDefault()),this.get("recipientModel")&&(s=this.get("recipientModel").getValue("displayname")),this.checkoutModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,showBodyLines:!1,showCancelButton:!1,showFooter:!1,showCancelX:!0,title:this.intlMessage({intlName:"gift-pro.GIFT_FLICKR_PRO",name:s}),subview:new e.Views["gift-pro-checkout-view"]({appContext:this.appContext,isMobile:this.isMobile,shouldDisplayYearlyLegalNotice:!0,recipientNsid:this.recipientNsid}),hideModalOverlay:!1,classList:"gift-pro-modal"}),this.checkoutModal.show(),this.checkoutModal.on("close",function(){t.sendGiftPurchaseEvent({step:"gift_modal_closed",recipientNsid:this.recipientNsid,gifterNsid:this.appContext.getViewer().signedIn?this.appContext.getViewer().nsid:"anonymous"})}.bind(this)),this.registerEventHandler(e.on("giftPro:successfulPurchase",function(){this.checkoutModal.close(),this.displaySuccessfulGift()}.bind(this))),this.registerEventHandler(e.on("giftPro:reposition",function(){this.repositionModal()}.bind(this))),this.registerEventHandler(e.on("giftPro:somethingWentWrong",function(){this.checkoutModal.close(),this.somethingWentWrong()}.bind(this))),this.registerEventHandler(e.on("giftPro:cancelPayment",function(){this.checkoutModal.close()}.bind(this))),t.sendGiftPurchaseEvent({step:"gift_modal_open",recipientNsid:this.recipientNsid,gifterNsid:this.appContext.getViewer().signedIn?this.appContext.getViewer().nsid:"anonymous"})},displaySuccessfulGift:function(){var i=this.get("recipientModel")?this.get("recipientModel").getValue("displayname"):"";this.successfulGiftModal=new e.Views.FluidModal({actionButtonLabel:this.intlMessage({intlName:"gift-pro.OK_THANKS"}),htmlMessage:this.templates("gift-pro-success")({recipientName:i,avatar:this.buildAvatar().avatar,titleBlock:this.buildTitleBlock().titleBlock}),showBodyLines:!0,showHeader:!1,width:500,appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,actionButtonDisabled:!1,actionButtonIsDangerous:!1,showCancelButton:!1,hideModalOverlay:!1,classList:"gift-pro-success-modal",showCancelX:!1}),this.successfulGiftModal.show(),this.registerEventHandler(this.successfulGiftModal.on("actionClick",function(){this.successfulGiftModal.close(),e.config.win.history.replaceState({},"",e.config.win.location.pathname),e.config.win.location.reload()}.bind(this)))},buildAvatar:function(){var i=this.get("recipientModel"),t=i&&i.getValue("buddyicon"),s=i&&e.URLHelper.generatePersonUrls(i);return i?{avatar:{canEdit:this.get("viewingSelf"),editUrl:"/iconbuilder/",sendFlickrMail:s.sendFlickrMail,linkUrl:s.photostream,icon:{retina:t.retina||t.large||t.medium,lowres:t.default},type:""}}:null},buildTitleBlock:function(){var e=this.get("recipientModel"),i={subtitle:"",follow:""};return e&&(i.title=e.getValue("displayname"),e.getValue("displayname")===e.getValue("realname")&&(i.subtitle=e.getValue("username")),i.isPro=!0,i.proBadge=e.getValue("proBadge")),{titleBlock:i}},repositionModal:function(e){this.checkoutModal&&this.checkoutModal.reposition()},somethingWentWrong:function(){var i=new e.Views.FluidModal({title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.REFRESH"}),textMessage:this.intlMessage({intlName:"gift-pro.SOMETHING_WENT_WRONG_GIFT"}),appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,actionButtonIsDangerous:!0,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!0});i.on("actionClick",function(){e.config.win.location.reload()}.bind(this)),i.show()}})}),"@VERSION@",{requires:["flickr-view","fluid-modal-view","person-models","person-public-profile-models","person-relationship-models","subscriptions-helper","gift-pro-checkout-view","hermes-template-gift-pro-success","hermes-template-gift-pro"],optionalRequires:["hermes-core"],langBundles:["header","common","wallet","gift-pro","checkout"]});YUI.add("fluid-coverphoto-view",(function(e,t){"use strict";var o=require("hermes-core/flog")(t),i=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),e.nsid||(o.warn("did not receive an `nsid` param and will default to appContext getViewer() nsid."),e.nsid=this.appContext.getViewer().nsid),this.set("pageNsid",e.nsid),this.set("hasFollow",e.hasFollow),this.set("models",{}),this.set("viewingSelf",!1),this.set("viewerIsGod",!1),this.set("currentHeaderPath",e.currentHeaderPath),this.geo=e.geo,this.openGiftPro=e.openGiftPro||!1,this},subviewConfig:{"gift-pro-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,placement:"photostream",disabled:function(){return!this.appContext.flipper.isFlipped("enable-gift-pro")}}},loadState:function(){return e.Promise.resolve()},getViewer:function(){var t=this.appContext.getViewer(),o=t&&t.signedIn&&t.nsid;return this.set("viewingSelf",o===this.get("pageNsid")),o&&this.set("viewerIsGod",t.isInsecureGod),e.Promise.resolve(null)},buildContainer:function(e){var t,o=this.get("models").relationship,n=!!o&&o.getValue("isIgnored"),s=!!o&&o.getValue("isIgnoredBy");return(e=e||{}).viewingSelf=this.get("viewingSelf"),e.viewerIsGod=this.get("viewerIsGod"),e.isFullBleed=this.get("fullBleed"),e.csrf=this.appContext.auth.csrf?this.appContext.auth.csrf:"",e.isGroup=!!this.get("models").groupInfo,e.upgradeProLink=i.getProLandingPageUrl(i.UTM_PRO_BADGE,{utm_medium:this.name}),e.isGroup?(t=this.groupStatusHelper.getInfo().joinStatus,e.actionData={isGroup:!0,canJoin:t.canJoin,hasJoined:t.hasJoined,hasRequested:t.hasRequested,showContextMenu:this.appContext.getViewer().signedIn}):e.actionData={isGroup:!1,isFollowing:!!o&&o.getValue("isContact"),isBlocked:n,isBlockedBy:s,canSeeFollowButton:!n&&!s&&!this.get("viewingSelf"),viewingSelf:this.get("viewingSelf"),showContextMenu:!0},this.get("models").person&&(e.isPro=this.get("models").person.getValue("isPro"),e.showSubtitle=this.appContext.flipper.isFlipped("enable-gift-acceptance")?this.get("models").person.getValue("isEligibleForGifts")||this.get("models").person.getValue("isPro"):this.get("models").person.getValue("isPro")||!this.get("viewingSelf")),YUI.Env.isServer?e.pageUrl=this.appContext.request.url:e.pageUrl=window.location.pathname,e.iconMessage||(e.iconMessage=this.intlMessage({intlName:"header.CHANGE_YOUR_BUDDY_ICON"})),e.titleBlock&&e.titleBlock.follow&&this.subviews["follow-view"]&&(e.titleBlock.follow=this.subviews["follow-view"].get("container")),this.setContainerWithTemplate("fluid-coverphoto",e),this},buildPersonCoverPhoto:function(){var e=this.get("models").personProfile;return e?{coverPhoto:{urls:e.getValue("coverPhotoUrls"),canEdit:this.get("canEditCoverPhoto"),attribution:""}}:null},buildGroupCoverPhoto:function(){var e=this.get("models").groupInfo;return e?{coverPhoto:{urls:e.getValue("group").getValue("coverPhotoUrls"),canEdit:this.get("canEditCoverPhoto"),attribution:e.getValue("coverPhotoAttribution")}}:null},buildAvatar:function(){var t=this.get("models")&&this.get("models").person,o=t&&t.getValue("buddyicon"),i=t&&e.URLHelper.generatePersonUrls(t);return t?{avatar:{canEdit:this.get("viewingSelf"),editUrl:"/iconbuilder/",sendFlickrMail:i.sendFlickrMail,linkUrl:i.photostream,icon:{retina:o.retina||o.large||o.medium,lowres:o.default},type:""}}:null},buildTitleBlock:function(){return{titleBlock:null}},buildMetadata:function(){return{metadata:null}},activate:function(){var t=this,o=this.get("container");return this.coverPhotoElement=this.get("container").one(".coverphoto"),this.FluidCoverPhotoEditor=new e.FluidCoverPhotoEditor(this.coverPhotoElement,this.appContext),this.contextMenuButton=o.one("context-menu-button"),this.get("canEditCoverPhoto")&&this.attachEvents({":pick":this.setupCoverPhotoEditor.bind(this),":cancelEdit":this.FluidCoverPhotoEditor.cancelCoverPhotoEditing.bind(this.FluidCoverPhotoEditor),":saveEdit":this.FluidCoverPhotoEditor.saveCoverPhoto.bind(this.FluidCoverPhotoEditor,this.groupId)}),this.get("container").one(".avatar .edit")&&this.attachEvents({":editAvatar":this.handleAvatarEditClick.bind(this)}),o.one(".context-menu-button")&&this.registerEventHandler(o.delegate("click",this.handleContextMenuClick.bind(this),".context-menu-button")),o.one(".coverphoto-actions")&&(this.groupStatusHelper&&(this.groupStatusHelper.on("groupJoined",(function(){e.config.win.location.href=e.config.win.location.href})),this.groupStatusHelper.on("groupLeft",(function(){e.config.win.location.href=e.config.win.location.href})),this.groupStatusHelper.on("joinCanceled",(function(){var e=o.one(".action-button.loading");e&&e.removeClass("loading")})),this.groupStatusHelper.on("leaveCanceled",(function(){var e=o.one(".action-button.loading");e&&e.removeClass("loading")})),this.registerEventHandler(o.delegate("click",(function(e){e.target.ancestor(".action-button",!0).addClass("loading"),t.groupStatusHelper.initiateJoinGroup()}),".action-button.join-button")),this.registerEventHandler(o.delegate("click",(function(e){e.target.ancestor(".action-button",!0).addClass("loading"),t.groupStatusHelper.initiateLeaveGroup()}),".action-button.joined-button")),this.registerEventHandler(o.delegate("click",(function(e){e.target.ancestor(".action-button",!0);t.groupStatusHelper.initiateJoinGroup()}),".action-button.requested-button"))),this.registerEventHandler(o.delegate("click",(function(e){var o=e.target.ancestor(".action-button",!0);t.appContext.getViewer().signedIn?t.toggleFollowPerson(!0,o):t.showSignUpModal()}),".action-button.follow-flickr-user-button")),this.registerEventHandler(o.delegate("click",(function(e){var o=e.target.ancestor(".action-button",!0);t.toggleFollowPerson(!1,o)}),".action-button.following-flickr-user-button"))),this.openGiftPro&&this.subviews["gift-pro-view"].openModal(),this},setupAvatarEditor:function(t){var i=this,n=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,noScroll:!0,hideModalOverlay:!1,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,width:Math.round(.6*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),title:this.intlMessage({intlName:"header.POSITION_IMAGE"}),actionButtonLabel:this.intlMessage({intlName:"common.SAVE"}),subview:new e.Views["fluid-avatar-editor-view"]({appContext:this.appContext,photoModel:t,contentHeight:Math.max(400,.6*Math.round(e.config.win.innerHeight))})});n.on("actionClick",(function(t){var n=this.get("subview").get("apiParams");i.groupId&&(n.group_id=i.groupId),i.get("container").one(".avatar").addClass("loading"),e.AvatarSaver.save(n,i.groupId?"group":null).then((function(){var t=e.config.win.location,o=t.href.replace(t.search,"");setTimeout((function(){e.config.win.location=o}),2e3)})).catch((function(e){o.error({err:e}),i.get("container").one(".avatar").removeClass("loading")}))})),n.show()},handleAvatarEditClick:function(t){var o,i=this;return t&&t.halt(),(o=this.getPhotoSelector()).on("actionClick",(function(e){var t=o.get("subview").get("selected");i.appContext.getModel("photo-models",t).then((function(e){o.close(),i.setupAvatarEditor(e)}))})),o.registerEventHandler(e.on("photoSelector:selected",(function(e){o.enableActionButton()}))),o.registerEventHandler(e.on("photoSelector:unselected",(function(e){o.disableActionButton()}))),o.show(),o},setupCoverPhotoEditor:function(){var t,o=this;return(t=this.getPhotoSelector({publicOnlyGroups:!0})).on("actionClick",(function(e){var i=t.get("subview").get("selected");o.appContext.getModel("photo-models",i).then((function(e){o.FluidCoverPhotoEditor.loadCoverPhoto(e).then((function(){t.close()}))}))})),t.registerEventHandler(e.on("photoSelector:selected",(function(e){t.enableActionButton()}))),t.registerEventHandler(e.on("photoSelector:unselected",(function(e){t.disableActionButton()}))),t.show(),t},getPhotoSelector:function(t){var i,n=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],s={appContext:this.appContext,searchable:{yours:!0,contacts:!1,everyone:!1,marketplace:!1},safeOnlyPhotos:!0},a=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],r=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"}];if(this.groupId){if(!this.get("models").group)return o.error("Missing group model");n=n.filter((function(e){return"upload"!==e.id})),i=this.intlMessage({intlName:"search.IN_GROUP_POOL",name:this.get("models").group.getValue("title")}),n[0].selected=!1,n.push({id:"group",name:this.intlMessage({intlName:"context.GROUP_CONTEXT_TITLE"}),value:"group",selected:!0}),s.groupId=this.groupId,s.defaultSelected={id:this.groupId,title:i,type:"group"},t&&t.publicOnlyGroups&&(s.publicOnlyGroups=!0),s.publicOnlyPhotos=!0}return new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:"",navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:this.appContext,links:n,enableSearch:!0,breakpointConfig:[{maxWidth:700,links:a,enableSearch:!1},{maxWidth:500,links:r,enableSearch:!1}]}),actionButtonLabel:this.intlMessage({intlName:"common.SELECT"}),actionButtonDisabled:!0,subview:new e.Views["photo-selector-view"](s),width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,classList:"photo-selector",hideModalOverlay:!1})},somethingWentWrong:function(t){var o=new e.Views.FluidModal({title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.REFRESH"}),textMessage:this.intlMessage({intlName:"gift-pro.SOMETHING_WENT_WRONG_GIFT"}),appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,actionButtonIsDangerous:!0,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!0});o.on("actionClick",function(){e.config.win.location.reload()}.bind(this)),o.show()},handleContextMenuClick:function(t){var o=this,i=(this.get("container"),t.target.ancestor(".context-menu-button",!0)),n=new e.Views["coverphoto-context-menu-view"]({appContext:this.appContext,viewingSelf:this.get("viewingSelf"),personModel:this.get("models").person,relationshipModel:this.get("models").relationship,isGroup:!!this.get("models").groupInfo,groupId:this.groupId,canEditCoverPhoto:this.get("canEditCoverPhoto"),groupStatusHelper:o.groupStatusHelper,pageNsid:this.get("pageNsid"),isMobile:this.isMobile}),s=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorOffsetVertical:0,contentPadding:0,dismissOnOverlayClick:!0,anchorElement:i,subview:n,closeOnScroll:!0,closeOnResize:!0,autoSizeToContent:!0,popBeforePushOther:!0}),a=function(){s.close(),o.setupCoverPhotoEditor()},r=function(){s.close(),o.groupStatusHelper.toggleMuteGroup(!0)},l=function(){s.close(),o.groupStatusHelper.toggleMuteGroup(!1)},c=function(){s.close(),o.groupStatusHelper.toggleNotificationsMute(!0)},u=function(){s.close(),o.groupStatusHelper.toggleNotificationsMute(!1)},h=function(){s.close(),o.showBlockConfirmCta()},d=function(){s.close(),o.toggleBlockPerson(!1)},g=function(){s.close(),e.ReportAbuseHelper.showReportModal(o.appContext)},p=function(){s.close(),o.showFamilyFriendErrorModal(o.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"}))},v=function(){s.close(),o.showFamilyFriendErrorModal(o.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"}))};this.registerEventHandler(n.on("changeCoverphoto",a)),this.registerEventHandler(n.on("hideFromFeed",r)),this.registerEventHandler(n.on("showInFeed",l)),this.registerEventHandler(n.on("muteNotifications",c)),this.registerEventHandler(n.on("unmuteNotifications",u)),this.registerEventHandler(n.on("block",h)),this.registerEventHandler(n.on("unblock",d)),this.registerEventHandler(n.on("report",g)),this.registerEventHandler(n.on("friendChangeError",p)),this.registerEventHandler(n.on("familyChangeError",v)),s.on("closeDroparound",(function(){o.detachRegisteredEvent(a),o.detachRegisteredEvent(r),o.detachRegisteredEvent(l),o.detachRegisteredEvent(c),o.detachRegisteredEvent(u),o.detachRegisteredEvent(h),o.detachRegisteredEvent(d),o.detachRegisteredEvent(g),o.detachRegisteredEvent(p),o.detachRegisteredEvent(v)})),s.show()},toggleFollowPerson:function(t,i){var n=this.get("models").relationship;return n.setValue("isContact",t),i.addClass("loading"),n.remoteUpdate().then((function(){e.config.win.location.href=e.config.win.location.href})).catch((function(e){i.removeClass("loading"),n.setValue("isContact",!t),o.error({err:e})}))},toggleBlockPerson:function(t){var i=this.get("models").relationship,n=i.getValue("isContact");return i.setValue("isIgnored",t),t&&i.setValue("isContact",!1),i.remoteUpdate().then((function(){e.config.win.location.href=e.config.win.location.href})).catch((function(e){i.setValue("isContact",n),o.error({err:e})}))},showBlockConfirmCta:function(t){var o=this,i=this.get("models").person.getValue("displayname"),n=new e.Views.FluidModal({appContext:this.appContext,title:this.intlHTMLMessage({intlName:"photo-card.BLOCK_USER_QUESTION",username:i}),message:"<p>"+this.intlMessage({intlName:"photo-card.BLOCK_CONFIRM_MESSAGE"})+"</p><p>"+this.intlHTMLMessage({intlName:"photo-card.BLOCK_CONFIRM_MESSAGE_NOTE"})+"</p>",actionButtonIsDangerous:!0,actionButtonLabel:this.intlMessage({intlName:"header.BLOCK"})});n.show(),n.on("actionClick",(function(){o.toggleBlockPerson(!0)}))},showFamilyFriendErrorModal:function(t){new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},showSignUpModal:function(){var t=this;this.appContext.getModel("person-models",this.nsid).then((function(o){var i,n=e.URLHelper.generatePersonUrls(o).photostream,s=t.intlMessage({intlName:"person.JOIN_FLICKR_AND_FOLLOW",person:o.getValue("displayname")}),a=o.getValue("buddyicon");a.displayUrl=a.retina||a.large||a.medium||a.default,(i=new e.Views.SignUpModal({appContext:t.appContext,signUpHeaderClass:"avatar person large no-menu no-edit",signUpHeaderImage:a.displayUrl,signUpTitle:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),signUpMessage:s,beaconPrefix:"follow"})).on("signUpClick",(function(o){e.SigninHelper.signUpPendingFollow({id:t.nsid},{postLoginUrl:n})})),i.on("signInClick",(function(o){e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:n})})),i.show()}))}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-fluid-coverphoto","hermes-template-flickr-balls","hermes-template-gift-pro-success","follow-view","fluid-avatar-editor-view","photo-selector-view","fluid-modal-nav-bar-view","fluid-modal-view","coverphoto-context-menu-view","fluid-coverphoto-editor","coverphoto-saver","avatar-saver","subscriptions-helper","group-status-helper","report-abuse-helper","gift-pro-view"],optional:["person-models","person-profile-models"],optionalRequires:["fluid","hermes-core"],langBundles:["header","common","gift-pro","global-nav","search","context","photo-card","person","gallery","groups"]});YUI.add("hermes-lang-context",(function(T,e){T.Intl.add("hermes/context","en-US",{CONTACTS_CONTEXT_TITLE:[{type:0,value:"Contacts"}],CONTACTS_CONTEXT_TYPE:[{type:0,value:"contacts"}],EXPLORE_CONTEXT_TITLE:[{type:0,value:"Explore"}],EXPLORE_CONTEXT_TYPE:[{type:0,value:"explore"}],FAVORITES_CONTEXT_TITLE:[{type:0,value:"Favorites"}],FAVORITES_CONTEXT_TYPE:[{type:0,value:"favorites"}],GALLERY_CONTEXT_TITLE:[{type:0,value:"Gallery"}],GALLERY_CONTEXT_TYPE:[{type:0,value:"gallery"}],GROUP_CONTEXT_TITLE:[{type:0,value:"Group"}],GROUP_CONTEXT_TYPE:[{type:0,value:"group"}],PHOTO_LIST_CONTEXT_TITLE:[{type:0,value:"Photo list"}],PHOTO_LIST_CONTEXT_TYPE:[{type:0,value:"photo list"}],PHOTOS_OF_CONTEXT_TITLE:[{type:0,value:"Photos of"}],PHOTOS_OF_CONTEXT_TYPE:[{type:0,value:"photos of"}],PHOTOSTREAM_CONTEXT_TITLE:[{type:0,value:"Photostream"}],PHOTOSTREAM_CONTEXT_TYPE:[{type:0,value:"photostream"}],RELATED_FAVORITES_CONTEXT_TITLE:[{type:0,value:"Related favorites"}],RELATED_FAVORITES_CONTEXT_TYPE:[{type:0,value:"related favorites"}],SET_CONTEXT_TITLE:[{type:0,value:"Set"}],SET_CONTEXT_TYPE:[{type:0,value:"set"}],LOADING:[{type:0,value:"loading"}]})}),"@VERSION@",{requires:["intl"]});YUI.add("fluid-photostream-coverphoto-view",(function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.namespace("Views")["fluid-coverphoto-view"],[],{langBundles:this.details.langBundles,subviewConfig:{"gift-pro-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,placement:"photostream",disabled:function(){return!this.appContext.flipper.isFlipped("enable-gift-pro")}}},initializer:function(t){return this.nsid=t.nsid,this.contextId=t.contextId||t.nsid,this.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext),this.launchEditAvatar=t.launchEditAvatar||!1,t.geo=t.geo,this.constructor.superclass.initializer.call(this,t)},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("person-models",this.get("pageNsid"))),n.push(this.appContext.getModel("person-contacts-count-models",this.get("pageNsid"))),n.push(this.appContext.getModel("person-profile-models",this.get("pageNsid"))),n.push(this.appContext.getModel("photostream-models",this.contextId)),n.push(this.appContext.getModel("person-relationship-models",this.get("pageNsid"))),n.push(this.getViewer()),e.Promise.all(n).then((function(e){var i=t.get("models");i.person=e[0],i.personContacts=e[1],i.personProfile=e[2],i.photostream=e[3],i.relationship=e[4],i.personViewer=e[5]||e[0],t.set("models",i),t.set("canEditCoverPhoto",t.get("viewingSelf")),t.set("coverPhotoId",i.photostream.getValue("id")),t.set("canShare",!0)}),(function(e){i.warn("Photostream cover error",{err:e})}))},buildContainer:function(){var t={};return t=e.merge(t,this.buildPersonCoverPhoto(),this.buildAvatar(),this.buildTitleBlock(),this.buildMetadata()),this.get("viewingSelf")&&(t.canEdit={buddyiconURL:"/iconbuilder/"}),this.constructor.superclass.buildContainer.call(this,t)},activate:function(){var e=this;return this.nsid&&this.signinPendingQueue&&this.signinPendingQueue.length>0&&this.signinPendingQueue.some((function(t){if("follow"===t.key&&t.value.id===e.nsid&&e.subviews["follow-view"])return e.subviews["follow-view"].followPerson(e.nsid),!0})),this.get("models")&&this.get("models").photostream&&this.registerEventHandler(this.get("models").photostream.registry.on(null,"modelsRemoved",this.handleDataChanged.bind(this))),this.get("models")&&this.get("models").personProfile&&this.registerEventHandler(this.get("models").personProfile.on("valuesChanged",this.handleLocationChanged.bind(this))),this.launchEditAvatar&&this.get("viewingSelf")&&this.handleAvatarEditClick(),this.constructor.superclass.activate.call(this)},handleLocationChanged:function(e){if(e&&e.location){var t=this.get("container").one(".metadata-content .cp-location"),i=this.get("container").one(".metadata-content");t?t.setHTML(e.location.newVal):i.prepend('<p class="truncate cp-location">'+e.location.newVal+"</p>")}},handleDataChanged:function(e){var t=this;e&&e[this.appContext.getViewer().nsid]&&this.loadState().then((function(){t.get("models")&&t.get("models").photostream&&(t.get("container").one(".metadata-content .photo-count").getDOMNode().innerHTML=t.intlMessage({intlName:"header.COUNT_PHOTOS",count:t.get("models").photostream.getValue("totalItems")}))}))},buildTitleBlock:function(){var t=this.get("models"),i=t&&this.get("models").person,n=i&&e.URLHelper.generatePersonUrls(i),o={subtitle:""};return o.follow=this.subviews["follow-view"]?this.subviews["follow-view"].get("container"):"",i&&(o.title=i.getValue("displayname"),i.getValue("displayname")===i.getValue("realname")&&(o.subtitle=i.getValue("username")),t.relationship.getValue("isIgnoredBy")||this.get("viewingSelf")||!n.sendFlickrMail||(o.sendFlickrMailUrl=n.sendFlickrMail),o.isPro=i.getValue("isPro"),o.proBadge=i.getValue("proBadge")),{titleBlock:o}},buildAvatar:function(){var t=this.get("models"),i=t&&t.person,n=i&&i.getValue("buddyicon"),o=i&&e.URLHelper.generatePersonUrls(i);return i?{avatar:{canEdit:this.get("viewingSelf"),editUrl:"/iconbuilder/",linkUrl:o?o.photostream:null,icon:{retina:n?n.retina||n.large||n.medium:null,lowres:n?n.default:null},type:"person"}}:null},buildMetadata:function(){var t,i,n=this.get("models"),o=n&&n.photostream,l=n&&n.personContacts,s=n&&n.person,a=n&&n.personProfile,r=o?o.getValue("totalItems"):null,d=s?s.getValue("dateCreated"):null,u=s?e.URLHelper.generatePersonUrls(s):{},h=l?l.getValue("followerCount"):0,g=l?l.getValue("followingCount"):0;return t=this.intlMessage({intlName:"header.FOLLOWER_COUNT",count:h,countString:e.IntlNumber.format(h,this.appContext.lang,1)}),i=this.intlMessage({intlName:"header.FOLLOWING_COUNT",count:g,countString:e.IntlNumber.format(g,this.appContext.lang,1)}),{metadata:[{count:r,photos:!!r},{location:a?a.getValue("location"):null,hasLocation:!!a&&!!a.getValue("location")},{date:d?d.year():null,memberSince:!!d},{followerCount:h,followingCount:g,followerString:t,followingString:i,contacts:!!l,viewingSelf:this.get("viewingSelf"),followingUrl:u.list,followerUrl:u.revlist}]}}})}),"@VERSION@",{requires:["flickr-view","fluid-coverphoto-view","follow-view","flutil","intl-number"],optionalRequires:["hermes-core"],langBundles:["header","common"]});YUI.add("hermes-template-album-list-toolbar",(function(e,a){var l=e.Template.Handlebars.revive({1:function(e,a,l,n,t){var s,r=null!=a?a:e.nullContext||{},i=e.hooks.helperMissing,o=e.escapeExpression,c=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'\t\t<a class="create-album" href="/photos/organize/?start_tab=new_set"><i></i><span>'+o((c(l,"intlMessage")||a&&c(a,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"album-page.NEW_ALBUM"},data:t,loc:{start:{line:3,column:82},end:{line:3,column:129}}}))+'</span></a>\n\t\t<div class="divider"></div>\n\t\t<a class="create-collection" href="/photos/organize/?start_tab=sets"><i></i><span>'+o((c(l,"intlMessage")||a&&c(a,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"album-page.NEW_COLLECTION"},data:t,loc:{start:{line:5,column:84},end:{line:5,column:136}}}))+'</span></a>\n\t\t<a class="view-collections" href="'+o(e.lambda(null!=(s=null!=a?c(a,"urls"):a)?c(s,"collections"):s,a))+'"><span>'+o((c(l,"intlMessage")||a&&c(a,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"album-page.VIEW_MY_COLLECTIONS"},data:t,loc:{start:{line:6,column:64},end:{line:6,column:121}}}))+"</span></a>\n"},3:function(e,a,l,n,t){var s,r=e.escapeExpression,i=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'\t\t<a class="view-collections" href="'+r(e.lambda(null!=(s=null!=a?i(a,"urls"):a)?i(s,"collections"):s,a))+'"><span>'+r((i(l,"intlMessage")||a&&i(a,"intlMessage")||e.hooks.helperMissing).call(null!=a?a:e.nullContext||{},{name:"intlMessage",hash:{intlName:"album-page.VIEW_COLLECTIONS"},data:t,loc:{start:{line:8,column:64},end:{line:8,column:118}}}))+"</span></a>\n"},compiler:[8,">= 4.3.0"],main:function(e,a,l,n,t){var s,r=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="album-toolbar-content">\n'+(null!=(s=r(l,"if").call(null!=a?a:e.nullContext||{},null!=a?r(a,"isViewingSelf"):a,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.program(3,t,0),data:t,loc:{start:{line:2,column:1},end:{line:9,column:8}}}))?s:"")+"</div>\n"},useData:!0}),n={};e.Array.each([],(function(a){var l=e.Template.get("hermes/"+a);l&&(n[a]=l)})),e.Template.register("hermes/album-list-toolbar",(function(a,t){return(t=t||{}).partials=t.partials?e.merge(n,t.partials):n,l(a,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("album-list-toolbar-view",(function(i){i.FlickrView.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{},initializer:function(i){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.nsid=i.nsid,this},loadState:function(){return this.appContext.getModel("person-models",this.nsid).then(function(i){this.set("person",i),this.set("isViewingSelf",this.nsid===this.appContext.getViewer().nsid)}.bind(this),(function(i){}))},buildContainer:function(){var t=this.get("person")&&i.URLHelper.generatePersonUrls(this.get("person"));return this.setContainerWithTemplate("album-list-toolbar",{urls:t,isViewingSelf:this.get("isViewingSelf")}),this},buildErrorContainer:function(){},activate:function(){return this}})}),"@VERSION@",{requires:["flickr-view","url-helper","hermes-template-album-list-toolbar"],optional:[],langBundles:["album-page","common"]});YUI.add("albums-list-page-view",(function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("albums-list-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.isOwner=e.isOwner,this.withSetId=e.withSetId,this.pageParams=e.pageParams,e.modelRegistryName="sets-models",e.isViewingSelf=!!this.appContext.getViewer().signedIn&&this.nsid===this.appContext.getViewer().nsid,e.photoListConfig={modelParams:{registryName:"sets-models",modelIdOrAttributes:e.nsid,collectionAttributeName:"albumsList"},interactionViewName:"photo-list-album-interaction-view",engagementModelName:"set-models",viewBeaconRestrictedAttribute:"primaryNeedsInterstitial",parentName:this.name,pageParams:e.pageParams,viewBeaconAttribute:"primary",measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:e.withSetId},e.photoListConfig.layout={targetRowHeight:240,forceAspectRatio:1,containerPadding:{top:8,right:0,bottom:8,left:0},itemSpacing:{horizontal:32,vertical:32}},this.isMobile&&(e.photoListConfig.layout.targetRowHeight=200,e.photoListConfig.layout.containerPadding.right=16,e.photoListConfig.layout.containerPadding.left=16,e.photoListConfig.layout.itemSpacing.horizontal=16,e.photoListConfig.layout.itemSpacing.vertical=16),e.subnavConfig={selected:"albums"},this.doOffline=!!this.appContext.flipper.isFlipped("enable-offline-downloadr"),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"fluid-photostream-coverphoto-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-magic-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-list-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["fluid-centered"]},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("sets-models",this.nsid),this.appContext.getModel("person-models",this.nsid)]).then((function(e){t.set("albumsListModel",e[0]),t.set("totalItems",e[0].getValue("totalItems")),t.set("owner",e[1])}))},buildContainer:function(){var e,t,i=this.get("totalItems");return t=this.pageParams.page>1||i>Math.abs((this.pageParams.viewPageSize||20)*(this.pageParams.page||1)),e=i>0,this.setContainerWithTemplate("albums-list-page",{"fluid-header":this.subviews["fluid-photostream-coverphoto-view"]?this.subviews["fluid-photostream-coverphoto-view"].get("container"):"","album-list-toolbar-view":e?this.subviews["album-list-toolbar-view"].get("container"):"",showPagination:t,isEmpty:0===this.get("totalItems").length,isViewingSelf:this.nsid===this.appContext.getViewer().nsid}),this},buildHeadContainer:function(){var e="";e+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),e+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),e+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",e):(this.set("headContainer",this.subviews["pagination-view"].get("headContainer")),this.updateHead())},showErrorModal:function(t){new e.Views.FluidModal({appContext:this.appContext,darkOverlay:!0,dismissOnOverlayClick:!0,showCancelButton:!1,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),title:this.intlMessage({intlName:"common.UPLOAD_ERROR_TITLE"}),message:t}).show()},showBalls:function(){this.balls||(this.balls=e.Node.create('<div class="loading-balls"></div>'),this.balls.setHTML(this.templates("flickr-balls")({}))),this.get("container").append(this.balls)},hideBalls:function(){this.balls.remove()},downloadAlbum:function(t){var i,o,a,s=this,n=!!this.appContext.flipper.isFlipped("enable-offline-downloadr");if(e.rapidTracker.beacon(this.name,"openDownloadAlbum"),(a=e.Array.find(this.get("albumsListModel").getOwnedModels(),(function(e){return e.id===t})))&&this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===a.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),n){if(1===a.getValue("totalCount"))return a.getValue("photoPageList").getPage({page:1,perPage:1}).then((function(t){var i,o,a,n=t[0];n.getValue("isVideo")&&!s.appContext.flipper.isFlipped("disable-video-playback")?o="/video_download.gne?id="+n.id:(i=(a=n.getLargestSize({excludeSizes:[]}).url.split(".")).pop(),0===(o=a.join(".")+"_d."+i).indexOf("//")&&(o="https:"+o)),e.config.doc.location.href=o}));if(a.getValue("totalCount")>e.config.flickr.downloadr.max_album_items)return e.rapidTracker.beacon(this.name,"albumListDownloadTooMany"),this.onError(this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:a.getValue("owner").getValue("displayname"),userurl:a.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+a.id}),this.intlMessage({intlName:"downloadr.TOO_MANY_TITLE"}),!0);o=s.bulkDownloaderView.createTitle(a.getValue("photoCount"),a.getValue("videoCount")),s.bulkDownloaderView.showDownloadDialog({doOffline:!0,title:o,setID:t})}else i=this.bulkDownloaderView.showLoadingDialog(),this.bulkDownloaderView.prepareArchive({set_id:t}).then((function(e){i.close(),s.bulkDownloaderView.showDownloadDialog(e)})).catch((function(e){i.close(),s.bulkDownloaderView.onError(e)}))},shareAlbum:function(t,i){var o=new e.Views.FluidShareAlbumView({appContext:this.appContext,albumId:t});this.showBalls(),e.rapidTracker.beacon(this.name,"openShareAlbum"),o.on("sharePresentationClose",o.destroy.bind(o)),o.initialize().then(function(){this.prepareModal(i)}.bind(o)).then(function(){this.hideBalls()}.bind(this)).catch(function(e){this.hideBalls()}.bind(this))},deleteAlbum:function(t){var o=this;return e.rapidTracker.beacon(this.name,"deleteAlbum"),this.confirmAlbumDelete(t).then((function(){return o.appContext.getModel("set-models",t).then((function(i){var a=[];return i.toJSON().photoPageList.forEach((function(e){a.push(o.appContext.getModel("photo-sets-models",e.id).then((function(e){e.getValue("sets").removeFromList(t)})))})),a.push(i.registry.remoteDelete(t).then((function(){o.get("albumsListModel").getValue("albumsList").remove(t),o.appContext.flapp.navigate(e.config.doc.location.href)}))),e.Promise.all(a)}))})).catch((function(e){i.error("Error deleting album",{err:e})}))},confirmAlbumDelete:function(t){var i=this;return e.rapidTracker.beacon(this.name,"deleteConfirm"),new e.Promise((function(t,o){var a=new e.Views.FluidModal({appContext:i.appContext,title:i.intlMessage({intlName:"common.CONFIRMATION"}),message:i.intlMessage({intlName:"album-page.CONFIRM_ALBUM_DELETE_NO_CONTENTS_DELETED"})});i.registerEventHandler(a.on("actionClick",(function(){t()}))),i.registerEventHandler(a.on("cancelClick",(function(){e.rapidTracker.beacon(i.name,"cancelDeleteConfirm"),o()}))),a.show()}))},handleClick:function(e){var t,i=e.target;i.hasClass("cta")&&(e.halt(),t=i.ancestor(".photo-list-album-interaction").getData("albumId"),i.hasClass("is-disabled")||(i.hasClass("share")?this.shareAlbum(t,i):i.hasClass("book")?this.appContext.flapp.navigate("/create"):i.hasClass("download")?this.downloadAlbum(t):i.hasClass("trash")&&this.deleteAlbum(t)))},destructor:function(){this.balls&&this.balls.inDoc()&&this.balls.remove(),this.balls=null,this.bulkDownloaderView&&this.bulkDownloaderView.destroy()},activate:function(){return this.registerEventHandler(this.get("container").on("click",this.handleClick,this)),this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext,doOffline:this.doOffline}),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.handlePageResize.bind(this))),this},handlePageResize:function(){e.config.win.innerWidth<=700?this.hasBeenMobilized||(this.hasBeenMobilized=!0,this.subviews["photo-list-view"].photoListLayout.targetRowHeight=200,this.subviews["photo-list-view"].photoListLayout.containerPadding.right=16,this.subviews["photo-list-view"].photoListLayout.containerPadding.left=16,this.subviews["photo-list-view"].photoListLayout.itemSpacing.horizontal=16,this.subviews["photo-list-view"].photoListLayout.itemSpacing.vertical=16):(this.hasBeenMobilized&&(this.subviews["photo-list-view"].photoListLayout.targetRowHeight=240,this.subviews["photo-list-view"].photoListLayout.containerPadding.right=0,this.subviews["photo-list-view"].photoListLayout.containerPadding.left=0,this.subviews["photo-list-view"].photoListLayout.itemSpacing.horizontal=32,this.subviews["photo-list-view"].photoListLayout.itemSpacing.vertical=32),this.hasBeenMobilized=!1)},onError:function(t,i,o){var a;return(a={appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),darkOverlay:!0})[o?"htmlMessage":"message"]=t,this.errorDialog=new e.Views.FluidModal(a),this.errorDialog.show(),this.errorDialog}},{ATTRS:{}})}),"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","hermes-template-albums-list-page","global-nav-view","footer-full-view","pagination-view","fluid-photostream-coverphoto-view","fluid-share-album-view","hermes-template-flickr-balls","album-list-toolbar-view","hermes-template-head-link","hermes-template-head-meta"],optionalRequires:["bulk-downloader-view","hermes-core"],optional:["sets-models"],langBundles:["album-page","common","downloadr","magic-empty-states","meta"]});